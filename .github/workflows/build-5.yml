name: Build Haxe 5

on:
  push:
    branches: ["master"]
  pull_request:
    branches: ["master"]
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      - name: Setup Haxe
        uses: krdlab/setup-haxe@v2
        with:
          haxe-version: '5.0.0-preview.1'
      - name: Install Haxe dependencies
        run: |
          haxelib install haxelib.json
          haxelib install hxjava # Java support
          haxelib install hxnodejs
          haxelib install hxcpp
      - name: Set as Library
        run: haxelib dev hxwell .
      - name: Create project
        run: |
          haxelib run hxwell new build
      - name: Build Targets
        run: |
          cd build
          echo "jvm"
          haxelib run hxwell build jvm  
          echo "php"
          haxelib run hxwell build php
          echo "hl"
          haxelib run hxwell build hl
          echo "neko"
          haxelib run hxwell build neko
          echo "cpp"
          haxelib run hxwell build cpp